# VNPT AI Model Evaluation

Dá»± Ã¡n Ä‘Ã¡nh giÃ¡ hiá»‡u nÄƒng cá»§a cÃ¡c mÃ´ hÃ¬nh AI VNPT trÃªn bá»™ dá»¯ liá»‡u Q&A.

---

## ğŸ“‹ Má»¥c lá»¥c

- [CÃ i Ä‘áº·t mÃ´i trÆ°á»ng](#-cÃ i-Ä‘áº·t-mÃ´i-trÆ°á»ng)
- [Cáº¥u hÃ¬nh API Keys](#-cáº¥u-hÃ¬nh-api-keys)
- [CÃ¡ch cháº¡y chÆ°Æ¡ng trÃ¬nh](#-cÃ¡ch-cháº¡y-chÆ°Æ¡ng-trÃ¬nh)
- [Káº¿t quáº£ Ä‘Ã¡nh giÃ¡](#-káº¿t-quáº£-Ä‘Ã¡nh-giÃ¡)

---

## ğŸ CÃ i Ä‘áº·t mÃ´i trÆ°á»ng

### 1. CÃ i Ä‘áº·t Conda (náº¿u chÆ°a cÃ³)

```bash
# Táº£i Miniconda (phiÃªn báº£n nháº¹ cá»§a Conda)
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh

# CÃ i Ä‘áº·t
bash Miniconda3-latest-Linux-x86_64.sh

# Khá»Ÿi Ä‘á»™ng láº¡i terminal hoáº·c cháº¡y
source ~/.bashrc
```

### 2. Táº¡o mÃ´i trÆ°á»ng Conda má»›i

```bash
# Táº¡o mÃ´i trÆ°á»ng vá»›i Python 3.10
conda create -n vnpt-ai python=3.10 -y

# KÃ­ch hoáº¡t mÃ´i trÆ°á»ng
conda activate vnpt-ai
```

### 3. CÃ i Ä‘áº·t cÃ¡c thÆ° viá»‡n cáº§n thiáº¿t

```bash
# CÃ i Ä‘áº·t cÃ¡c package chÃ­nh
pip install requests openai

# Hoáº·c táº¡o file requirements.txt vÃ  cÃ i Ä‘áº·t
pip install -r requirements.txt
```

**CÃ¡c thÆ° viá»‡n cáº§n thiáº¿t:**
- `requests` - Gá»i API HTTP
- `openai` - OpenAI Python SDK (náº¿u sá»­ dá»¥ng model OpenAI)
- `numpy` - Xá»­ lÃ½ vector cho semantic filtering

```bash
# CÃ i Ä‘áº·t Ä‘áº§y Ä‘á»§
pip install requests openai numpy
```

---

## ğŸ”‘ Cáº¥u hÃ¬nh API Keys

### File `api-keys.json` - Cáº¥u hÃ¬nh cho VNPT AI API

File nÃ y chá»©a thÃ´ng tin xÃ¡c thá»±c Ä‘á»ƒ káº¿t ná»‘i vá»›i cÃ¡c model VNPT AI (small, large, embeddings).

**Cáº¥u trÃºc file:**

```json
[
  {
    "authorization": "Bearer <JWT_TOKEN>",
    "tokenKey": "<TOKEN_KEY>",
    "llmApiName": "LLM large",
    "tokenId": "<TOKEN_ID>"
  },
  {
    "authorization": "Bearer <JWT_TOKEN>",
    "tokenKey": "<TOKEN_KEY>",
    "llmApiName": "LLM small",
    "tokenId": "<TOKEN_ID>"
  },
  {
    "authorization": "Bearer <JWT_TOKEN>",
    "tokenKey": "<TOKEN_KEY>",
    "llmApiName": "LLM embedings",
    "tokenId": "<TOKEN_ID>"
  }
]
```

**LÆ°u Ã½:**
- Index 0: Model **large** (máº¡nh nháº¥t)
- Index 1: Model **small** (nháº¹ hÆ¡n)
- Index 2: Model **embeddings** (táº¡o vector)

**CÃ¡ch sá»­ dá»¥ng:**
1. Copy file `api-keys.json.example` thÃ nh `api-keys.json`
2. Äiá»n thÃ´ng tin xÃ¡c thá»±c cá»§a báº¡n vÃ o file

```bash
cp api-keys.json.example api-keys.json
# Sau Ä‘Ã³ chá»‰nh sá»­a file api-keys.json vá»›i thÃ´ng tin cá»§a báº¡n
```

---

### File `openai_config.json` - Cáº¥u hÃ¬nh cho OpenAI API

File nÃ y chá»©a thÃ´ng tin xÃ¡c thá»±c Ä‘á»ƒ káº¿t ná»‘i vá»›i OpenAI API.

**Cáº¥u trÃºc file:**

```json
{
  "openai": {
    "base_url": "https://api.openai.com/v1",
    "api_key": "sk-proj-xxxxxxxxxxxx",
    "model": "gpt-4o-mini"
  }
}
```

**CÃ¡c trÆ°á»ng:**
- `base_url`: URL endpoint cá»§a OpenAI API
- `api_key`: API key cá»§a báº¡n tá»« OpenAI
- `model`: TÃªn model sá»­ dá»¥ng (vÃ­ dá»¥: `gpt-4o-mini`, `gpt-4o`, `gpt-3.5-turbo`)

**CÃ¡ch sá»­ dá»¥ng:**
1. Copy file `openai_config.json.example` thÃ nh `openai_config.json`
2. Äiá»n API key cá»§a báº¡n vÃ o file

```bash
cp openai_config.json.example openai_config.json
# Sau Ä‘Ã³ chá»‰nh sá»­a file openai_config.json vá»›i API key cá»§a báº¡n
```

---

## ğŸš€ CÃ¡ch cháº¡y chÆ°Æ¡ng trÃ¬nh

### Cháº¡y Ä‘Ã¡nh giÃ¡ vá»›i `evaluate.py`

```bash
# KÃ­ch hoáº¡t mÃ´i trÆ°á»ng (náº¿u chÆ°a)
conda activate vnpt-ai

# Cháº¡y vá»›i model large (máº·c Ä‘á»‹nh)
python evaluate.py

# Cháº¡y vá»›i model small
python evaluate.py --model small

# Cháº¡y vá»›i OpenAI
python evaluate.py --model openai
```

### CÃ¡c tham sá»‘ dÃ²ng lá»‡nh

| Tham sá»‘ | MÃ´ táº£ | Máº·c Ä‘á»‹nh |
|---------|-------|----------|
| `--model` | Loáº¡i model: `small`, `large`, `openai` | `large` |
| `--input` | File JSON chá»©a cÃ¢u há»i | `val.json` |
| `--max-questions` | Sá»‘ cÃ¢u há»i tá»‘i Ä‘a Ä‘á»ƒ Ä‘Ã¡nh giÃ¡ | Táº¥t cáº£ |
| `--start-index` | Index báº¯t Ä‘áº§u (0-based) | `0` |
| `--end-index` | Index káº¿t thÃºc (exclusive) | Cuá»‘i danh sÃ¡ch |
| `--verbose` | In chi tiáº¿t cho má»—i cÃ¢u há»i | `False` |
| `--no-save` | KhÃ´ng lÆ°u káº¿t quáº£ vÃ o file | `False` |
| `--save-predictions` | LÆ°u predictions vÃ o `predict.csv` | `False` |

### VÃ­ dá»¥ sá»­ dá»¥ng

```bash
# ÄÃ¡nh giÃ¡ 100 cÃ¢u há»i Ä‘áº§u tiÃªn vá»›i model large
python evaluate.py --model large --input val.json --max-questions 100

# ÄÃ¡nh giÃ¡ vá»›i cháº¿ Ä‘á»™ verbose (chi tiáº¿t)
python evaluate.py --model small --input val.json --verbose

# ÄÃ¡nh giÃ¡ vÃ  lÆ°u predictions vÃ o CSV
python evaluate.py --model openai --input test.json --save-predictions

# ÄÃ¡nh giÃ¡ tá»« cÃ¢u 10 Ä‘áº¿n cÃ¢u 20
python evaluate.py --model large --input val.json --start-index 10 --end-index 20

# ÄÃ¡nh giÃ¡ táº¥t cáº£ cÃ¢u há»i mÃ  khÃ´ng lÆ°u káº¿t quáº£
python evaluate.py --model large --no-save
```

### Test API riÃªng láº»

```bash
# Test VNPT AI API
python vnpt_ai_client.py

# Test OpenAI API
python openai_client.py
```

---

## ğŸ¯ Tá»‘i Æ°u hÃ³a Model (Má»›i!) â­

### Unified Pipeline - Há»‡ thá»‘ng Ä‘Ã¡nh giÃ¡ thá»‘ng nháº¥t

**TÃ­nh nÄƒng má»›i:**
- âœ… Improved prompts cho MATH (tÄƒng accuracy tá»« 75% â†’ 85%+)
- âœ… Há»— trá»£ cáº£ VNPT AI vÃ  OpenAI models
- âœ… 4 strategies: baseline, hybrid, cost-optimized, quality-optimized
- âœ… Flexible configuration qua command line

### Quick Start

```bash
# KÃ­ch hoáº¡t mÃ´i trÆ°á»ng
conda activate vnpt-ai

# Hybrid strategy vá»›i VNPT models (Khuyáº¿n nghá»‹)
python unified_pipeline.py --strategy hybrid

# Hybrid vá»›i OpenAI models
python unified_pipeline.py --strategy hybrid --provider openai

# Baseline Ä‘á»ƒ so sÃ¡nh
python unified_pipeline.py --strategy baseline

# Test nhanh vá»›i 50 cÃ¢u
python unified_pipeline.py --strategy hybrid --max-questions 50
```

### So sÃ¡nh cÃ¡c chiáº¿n lÆ°á»£c

| Chiáº¿n lÆ°á»£c | Chi phÃ­ | Accuracy | MATH | CONTEXT | KNOWLEDGE |
|------------|---------|----------|------|---------|-----------|
| **Baseline** | 100% | ~92% | 85% | 100% | 90% |
| **Hybrid** â­ | 65% | ~90% | 85%+ | 100% | 88% |
| Cost-Optimized | 50% | ~85% | 80% | 95% | 85% |
| Quality-Optimized | 100% | ~95% | 95% | 100% | 95% |


### VÃ­ dá»¥ sá»­ dá»¥ng

```bash
# ÄÃ¡nh giÃ¡ full dataset vÃ  lÆ°u predictions
python unified_pipeline.py --strategy hybrid --save-predictions

# Verbose mode Ä‘á»ƒ debug
python unified_pipeline.py --strategy hybrid --max-questions 10 --verbose

# So sÃ¡nh VNPT vs OpenAI
python unified_pipeline.py --strategy hybrid --provider vnpt --max-questions 50
python unified_pipeline.py --strategy hybrid --provider openai \
  --large-model gpt-4o-mini --small-model gpt-3.5-turbo --max-questions 50

# Táº¯t improved prompts Ä‘á»ƒ so sÃ¡nh
python unified_pipeline.py --strategy hybrid --no-improved-prompts
```


## ğŸ“ Cáº¥u trÃºc dá»± Ã¡n

```
VNPT_repo/
â”œâ”€â”€ api-keys.json           # Cáº¥u hÃ¬nh VNPT AI API (khÃ´ng commit)
â”œâ”€â”€ api-keys.json.example   # Template cho api-keys.json
â”œâ”€â”€ openai_config.json      # Cáº¥u hÃ¬nh OpenAI API (khÃ´ng commit)
â”œâ”€â”€ openai_config.json.example # Template cho openai_config.json
â”œâ”€â”€ evaluate.py             # Script Ä‘Ã¡nh giÃ¡ cÆ¡ báº£n
â”œâ”€â”€ evaluate_hybrid.py      # Script Ä‘Ã¡nh giÃ¡ vá»›i Hybrid Pipeline
â”œâ”€â”€ unified_pipeline.py     # Unified Pipeline - Há»‡ thá»‘ng thá»‘ng nháº¥t (Má»šI!) â­
â”œâ”€â”€ vnpt_ai_client.py       # Client cho VNPT AI API
â”œâ”€â”€ openai_client.py        # Client cho OpenAI API
â”œâ”€â”€ val.json                # Bá»™ dá»¯ liá»‡u validation
â”œâ”€â”€ test.json               # Bá»™ dá»¯ liá»‡u test
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ classifier.py       # PhÃ¢n loáº¡i cÃ¢u há»i
â”‚   â”œâ”€â”€ context_filter.py   # Lá»c context
â”‚   â”œâ”€â”€ extractor.py        # TrÃ­ch xuáº¥t cÃ¢u tráº£ lá»i
â”‚   â”œâ”€â”€ format_choices.py   # Format cÃ¡c lá»±a chá»n
â”‚   â”œâ”€â”€ model.py            # Wrapper cho cÃ¡c model
â”‚   â”œâ”€â”€ pipeline.py         # Pipeline Ä‘Ã¡nh giÃ¡ cÆ¡ báº£n
â”‚   â”œâ”€â”€ hybrid_pipeline.py  # Hybrid Pipeline tá»‘i Æ°u
â”‚   â”œâ”€â”€ prompt_builder.py   # XÃ¢y dá»±ng prompt cÆ¡ báº£n
â”‚   â”œâ”€â”€ improved_prompt_builder.py  # Improved prompts (Má»šI!) â­
â”‚   â””â”€â”€ vector_db.py        # Vector database
â”œâ”€â”€ README.MD               # File nÃ y
â”œâ”€â”€ UNIFIED_PIPELINE_GUIDE.md    # HÆ°á»›ng dáº«n Unified Pipeline (Má»šI!) â­
â”œâ”€â”€ OPENAI_SETUP.md         # HÆ°á»›ng dáº«n OpenAI integration (Má»šI!) â­
â”œâ”€â”€ OPTIMIZATION_STRATEGY.md     # Chiáº¿n lÆ°á»£c tá»‘i Æ°u chi tiáº¿t
â””â”€â”€ test_openai_integration.py   # Test script cho OpenAI (Má»šI!)
```